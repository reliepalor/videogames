<div class="flex flex-col h-full">

  <!-- Header -->
  <div class="p-4 border-b flex items-center gap-3">
    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-indigo-500
                text-white flex items-center justify-center">
      A
    </div>
    <div>
      <div class="font-medium">{{ subject || 'Conversation' }}</div>
      <div class="text-xs text-gray-500">
        <span *ngIf="status === 'Open'">Open</span>
        <span *ngIf="status === 'Closed'" class="text-red-500">Closed</span>
      </div>
    </div>
    <div class="ml-auto">
      <button
        *ngIf="status === 'Open'"
        (click)="closeConversation()"
        class="text-xs text-red-600 hover:text-red-800">
        Close
      </button>
    </div>
  </div>

  <!-- Typing indicator -->
  <div class="px-4 py-2 bg-slate-50" *ngIf="isTyping">
    <div class="flex items-center gap-1">
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
    </div>
  </div>

  <!-- Messages -->
  <div class="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-2 scrollbar-hide custom-scrollbar" #chatContainer>
    <div
      *ngFor="let msg of messages"
      class="flex"
      [class.justify-end]="msg.isAdmin">

      <div
        class="px-4 py-2 rounded-2xl max-w-[70%] relative cursor-pointer hover:opacity-90 transition-opacity"
        [class.bg-violet-600]="msg.isAdmin"
        [class.text-white]="msg.isAdmin"
        [class.bg-white]="!msg.isAdmin"
        (click)="toggleTimestamp(msg)">
        {{ msg.message }}
        <!-- Timestamp tooltip -->
        <div class="absolute -bottom-6 left-0 text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 transition-opacity z-10"
             [class.opacity-100]="selectedMessageId === msg.id"
             [class.bg-gray-800]="msg.isAdmin"
             [class.text-white]="msg.isAdmin"
             [class.bg-gray-200]="!msg.isAdmin"
             [class.text-gray-800]="!msg.isAdmin">
          {{ formatTimestamp(msg.createdAt) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="border-t p-3 flex items-center gap-2" *ngIf="status === 'Open'">
    <input
      [(ngModel)]="newMessage"
      (keydown.enter)="sendMessage()"
      (input)="onTyping()"
      placeholder="Reply as admin..."
      class="flex-1 border rounded-xl px-4 py-2" />
    <button
      (click)="sendMessage()"
      class="bg-violet-600 text-white px-4 py-2 rounded-xl">
      Send
    </button>
  </div>

  <!-- Closed state message -->
  <div class="border-t p-3 text-center text-gray-500 text-sm" *ngIf="status !== 'Open'">
    This conversation is closed
  </div>
</div>

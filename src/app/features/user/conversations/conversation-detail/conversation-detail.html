<div class="flex flex-col h-full">

  <div class="p-4 border-b flex items-center gap-3 mt-20">
    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-indigo-500
                text-white flex items-center justify-center">
      A
    </div>
    <div>
      <div class="font-medium">Support Team</div>
      <div class="text-xs text-gray-500">Online</div>
    </div>
  </div>

  <!-- Typing indicator -->
  <div class="px-4 py-2 bg-slate-50" *ngIf="isTyping">
    <div class="flex items-center gap-1">
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
      <span class="typing-dot"></span>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-2 scrollbar-hide custom-scrollbar" #chatContainer>
    <div *ngFor="let m of messages; trackBy: trackByMessageId"
         class="flex"
         [class.justify-end]="!m.isAdmin">

      <div
        class="px-4 py-2 rounded-2xl max-w-[70%] relative cursor-pointer hover:opacity-90 transition-opacity"
        [class.bg-violet-600]="!m.isAdmin"
        [class.text-white]="!m.isAdmin"
        [class.bg-white]="m.isAdmin"
        (click)="toggleTimestamp(m)">
        {{ m.message }}
        <!-- Timestamp tooltip -->
        <div class="absolute -bottom-6 left-0 text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 transition-opacity z-10"
             [class.opacity-100]="selectedMessageId === m.id"
             [class.bg-gray-800]="!m.isAdmin"
             [class.text-white]="!m.isAdmin"
             [class.bg-gray-200]="m.isAdmin"
             [class.text-gray-800]="m.isAdmin">
          {{ formatTimestamp(m.createdAt) }}
        </div>
      </div>
    </div>
  </div>

  <div class="border-t p-3 flex items-center gap-2">
    <input
      [(ngModel)]="newMessage"
      (keydown.enter)="send()"
      (input)="onTyping()"
      class="flex-1 border rounded-xl px-4 py-2" />
    <button
      (click)="send()"
      class="bg-violet-600 text-white px-4 py-2 rounded-xl">
      Send
    </button>
  </div>
</div>

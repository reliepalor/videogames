<style></style>

<!-- GLASS NAVBAR -->
<nav
  class="fixed top-4 left-1/2 -translate-x-1/2 z-50
         w-[95%] max-w-7xl
         rounded-2xl backdrop-blur-xl
         border shadow-lg
         transition-all duration-300"
  [ngClass]="isDarkMode
    ? 'bg-white/10 border-white/20 text-white'
    : 'bg-white/70 border-gray-200 text-gray-900'">

  <div class="flex items-center justify-between px-6 py-3">

    <!-- BRAND -->
    <div class="flex justify-center items-center gap-3">
      <svg 
        class="w-7 h-7 text-purple-600 flex-shrink-0"
        viewBox="0 0 24 24" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M6 12h2m4-4v2m0 4v2m4-4h2
             M7 17l2-2h6l2 2
             M5 7h14a2 2 0 0 1 2 2v6
             a5 5 0 0 1-5 5H8
             a5 5 0 0 1-5-5V9
             a2 2 0 0 1 2-2z"/>
      </svg>

      <a routerLink="/user-dashboard"
         class="text-sm font-semibold tracking-wide hover:opacity-80 transition">
        Outspace
      </a>
    </div>

    <!-- DESKTOP LINKS -->
    <div class="hidden md:flex items-center gap-8 text-sm font-medium" *ngIf="user$ | async as user">
      <a (click)="guardedNavigate('/games')" class="opacity-80 hover:opacity-100 transition cursor-pointer">Games</a>
      <a (click)="guardedNavigate('/orders')" class="opacity-80 hover:opacity-100 transition cursor-pointer">Orders</a>
      <a (click)="guardedNavigate('/cart')" class="opacity-80 hover:opacity-100 transition cursor-pointer">Cart</a>
    </div>

    <!-- RIGHT -->
    <div class="flex items-center gap-3">

      <!-- ðŸ’¬ MESSENGER ICON -->
      <button
        *ngIf="user$ | async"
        (click)="guardedNavigate('/conversations')"
        class="relative w-9 h-9 rounded-xl flex items-center justify-center
               transition hover:scale-105"
        [ngClass]="isDarkMode ? 'hover:bg-white/10' : 'hover:bg-black/10'">

        <!-- ICON -->
        <svg class="w-5 h-5"
             fill="none"
             stroke="currentColor"
             viewBox="0 0 24 24"
             stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8 10h8m-8 4h5
               M21 12c0 4.418-4.03 8-9 8
               a9.77 9.77 0 01-4-.8L3 20l1.5-3.8
               A7.94 7.94 0 013 12
               c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>

        <!-- UNREAD BADGE -->
        <span
          *ngIf="unreadCount > 0"
          class="absolute -top-1 -right-1
                 min-w-[18px] h-[18px]
                 px-1 rounded-full
                 bg-purple-600 text-white
                 text-[10px] font-semibold
                 flex items-center justify-center">
          {{ unreadCount }}
        </span>
      </button>

      <!-- THEME TOGGLE -->
      <button
        (click)="toggleTheme()"
        class="w-9 h-9 rounded-xl flex items-center justify-center
               transition hover:scale-105"
        [ngClass]="isDarkMode ? 'hover:bg-white/10' : 'hover:bg-black/10'">

        <svg *ngIf="!isDarkMode"
             class="w-5 h-5 text-yellow-400"
             fill="none" stroke="currentColor"
             viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4 12H2M22 12h-2"/>
        </svg>

        <svg *ngIf="isDarkMode"
             class="w-5 h-5 text-purple-300"
             fill="currentColor"
             viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
        </svg>
      </button>

      <!-- USER DROPDOWN -->
      <div *ngIf="user$ | async as user; else desktopAuth"
           class="hidden md:block relative">

        <button
          (click)="toggleDropdown()"
          class="flex items-center gap-2 p-1 rounded-full
                 transition hover:scale-105">

          <div class="w-9 h-9 rounded-full overflow-hidden">
            <img *ngIf="user.profilePicture; else initials"
                 [src]="user.profilePicture"
                 class="w-full h-full object-cover">

            <ng-template #initials>
              <div
                class="w-full h-full bg-gradient-to-br
                       from-purple-500 to-indigo-500
                       flex items-center justify-center
                       text-white text-sm font-semibold">
                {{ getInitials(user.username) }}
              </div>
            </ng-template>
          </div>
        </button>

        <!-- DROPDOWN -->
        <div *ngIf="isDropdownOpen"
          class="absolute right-0 mt-4 w-56
                 rounded-2xl backdrop-blur-xl
                 border shadow-xl animate-fade-in"
          [ngClass]="isDarkMode
            ? 'bg-gray-900/80 border-white/10'
            : 'bg-white/80 border-gray-200'">

          <div class="px-4 py-3 text-xs opacity-70 truncate">
            {{ user.email }}
          </div>

          <a routerLink="/profile" (click)="closeAllMenus()"
             class="block px-4 py-3 text-sm hover:bg-white/10 transition">
            Profile
          </a>

          <a routerLink="/settings/password" (click)="closeAllMenus()"
             class="block px-4 py-3 text-sm hover:bg-white/10 transition">
            Security
          </a>

          <button
            (click)="logout()"
            class="w-full text-left px-4 py-3 text-sm
                   text-red-500 hover:bg-red-500/10 transition">
            Logout
          </button>
        </div>
      </div>

      <!-- LOGIN / REGISTER -->
      <ng-template #desktopAuth>
        <div class="hidden md:flex items-center gap-2">
          <a routerLink="/login"
             class="px-4 py-2 text-sm rounded-xl bg-purple-500 text-white hover:bg-purple-600 transition">
            Login
          </a>
          <a routerLink="/register"
             class="px-4 py-2 text-sm rounded-xl border border-purple-500 text-purple-500 hover:bg-purple-500 hover:text-white transition">
            Register
          </a>
        </div>
      </ng-template>

      <!-- MOBILE BUTTON -->
      <button
        class="md:hidden w-9 h-9 rounded-xl flex items-center justify-center"
        (click)="toggleMobileMenu()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor"
             viewBox="0 0 24 24">
          <path stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

    </div>
  </div>
</nav>
